<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In | ANGAZA Professional Employment Platform</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
  /* ====== CSS Reset & Variables ====== */
  :root {
    --primary: #0066cc;
    --primary-dark: #0052a3;
    --primary-light: #e6f2ff;
    --secondary: #1a1a2e;
    --accent: #00a8cc;
    --light: #f8fafc;
    --gray-50: #f9fafb;
    --gray-100: #f1f5f9;
    --gray-200: #e2e8f0;
    --gray-300: #cbd5e1;
    --gray-400: #94a3b8;
    --gray-500: #64748b;
    --gray-600: #475569;
    --gray-700: #334155;
    --gray-800: #1e293b;
    --gray-900: #0f172a;
    --success: #10b981;
    --success-light: #d1fae5;
    --warning: #f59e0b;
    --warning-light: #fef3c7;
    --danger: #ef4444;
    --danger-light: #fee2e2;
    --border: 1px solid #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 6px 8px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --radius: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    color: var(--gray-900);
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    padding: 1.5rem;
    position: relative;
    overflow-x: hidden;
  }

  /* ====== Background Pattern ====== */
  .bg-pattern {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    overflow: hidden;
  }

  .bg-circle {
    position: absolute;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(0, 102, 204, 0.03) 0%, rgba(0, 168, 204, 0.03) 100%);
  }

  .bg-circle-1 {
    width: 400px;
    height: 400px;
    top: -100px;
    right: -100px;
  }

  .bg-circle-2 {
    width: 300px;
    height: 300px;
    bottom: -50px;
    left: -50px;
  }

  .bg-circle-3 {
    width: 200px;
    height: 200px;
    bottom: 50%;
    right: 20%;
  }

  /* ====== Header ====== */
  .header {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    border-bottom: var(--border);
    z-index: 1000;
    padding: 1rem 0;
  }

  .header-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
  }

  .logo-icon {
    width: 40px;
    height: 40px;
    background: var(--primary);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
  }

  .logo-text {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-900);
    letter-spacing: -0.015em;
  }

  .nav {
    display: flex;
    align-items: center;
    gap: 3rem;
  }

  .nav-link {
    color: var(--gray-700);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    position: relative;
    transition: color 0.2s ease;
  }

  .nav-link:hover {
    color: var(--primary);
  }

  /* ====== Login Container ====== */
  .login-container {
    position: relative;
    z-index: 10;
    width: 100%;
    max-width: 480px;
    margin: 80px auto 40px;
  }

  .login-card {
    background: white;
    border-radius: var(--radius-xl);
    padding: 2.5rem;
    box-shadow: var(--shadow-xl);
    border: var(--border);
    animation: slideUpFade 0.6s ease;
  }

  @keyframes slideUpFade {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ====== Logo in Card ====== */
  .card-logo {
    display: flex;
    justify-content: center;
    margin-bottom: 1.5rem;
  }

  .card-logo-icon {
    width: 64px;
    height: 64px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2rem;
    box-shadow: var(--shadow-md);
  }

  /* ====== Form Header ====== */
  .form-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .form-header h2 {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 0.5rem;
  }

  .form-header p {
    color: var(--gray-600);
    font-size: 0.95rem;
  }

  /* ====== Form Group ====== */
  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 0.5rem;
  }

  .input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .input-wrapper i {
    position: absolute;
    left: 1rem;
    color: var(--gray-400);
    font-size: 1rem;
    transition: color 0.2s ease;
  }

  .input-wrapper input {
    width: 100%;
    padding: 0.875rem 1rem 0.875rem 2.75rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    font-family: 'Inter', sans-serif;
    font-size: 0.95rem;
    color: var(--gray-900);
    background: white;
    transition: all 0.2s ease;
  }

  .input-wrapper input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
  }

  .input-wrapper input:focus + i {
    color: var(--primary);
  }

  .input-wrapper input::placeholder {
    color: var(--gray-400);
  }

  /* Password Toggle Button */
  .password-toggle {
    position: absolute;
    right: 1rem;
    background: none;
    border: none;
    color: var(--gray-400);
    cursor: pointer;
    padding: 0.25rem;
    transition: color 0.2s ease;
  }

  .password-toggle:hover {
    color: var(--primary);
  }

  /* ====== Remember Me & Forgot Password ====== */
  .form-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .remember-me {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .remember-me input[type="checkbox"] {
    width: 16px;
    height: 16px;
    accent-color: var(--primary);
    border-radius: 4px;
    cursor: pointer;
  }

  .remember-me label {
    font-size: 0.875rem;
    color: var(--gray-700);
    cursor: pointer;
  }

  .forgot-link {
    font-size: 0.875rem;
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .forgot-link:hover {
    color: var(--primary-dark);
    text-decoration: underline;
  }

  /* ====== Login Button ====== */
  .login-btn {
    width: 100%;
    padding: 1rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-family: 'Inter', sans-serif;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    position: relative;
    overflow: hidden;
  }

  .login-btn:hover:not(:disabled) {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .login-btn:active:not(:disabled) {
    transform: translateY(0);
  }

  .login-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  /* Loading State */
  .login-btn .spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Ripple Effect */
  .login-btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.5);
    opacity: 0;
    border-radius: 50%;
    transform: scale(1, 1) translate(-50%);
    transform-origin: 50% 50%;
  }

  .login-btn:focus:not(:active)::after {
    animation: ripple 1s ease-out;
  }

  @keyframes ripple {
    0% {
      transform: scale(0, 0);
      opacity: 0.5;
    }
    100% {
      transform: scale(20, 20);
      opacity: 0;
    }
  }

  /* ====== Sign Up Link ====== */
  .signup-section {
    text-align: center;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: var(--border);
  }

  .signup-section p {
    color: var(--gray-600);
    font-size: 0.95rem;
    margin-bottom: 0.75rem;
  }

  .signup-link {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s ease;
  }

  .signup-link:hover {
    color: var(--primary-dark);
    text-decoration: underline;
  }

  /* ====== Trust Badges ====== */
  .trust-badges {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 2rem;
  }

  .trust-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--gray-600);
    font-size: 0.875rem;
  }

  .trust-badge i {
    color: var(--success);
  }

  /* ====== Toast Notifications ====== */
  .toast-notification {
    position: fixed;
    top: 100px;
    right: 30px;
    background: white;
    border-radius: var(--radius-lg);
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: var(--shadow-xl);
    transform: translateX(150%);
    transition: transform 0.3s ease;
    z-index: 2000;
    max-width: 400px;
    width: calc(100% - 60px);
    border-left: 4px solid var(--primary);
  }

  .toast-notification.show {
    transform: translateX(0);
  }

  .toast-notification.success {
    border-left-color: var(--success);
  }

  .toast-notification.error {
    border-left-color: var(--danger);
  }

  .toast-notification i {
    font-size: 1.25rem;
  }

  .toast-notification.success i {
    color: var(--success);
  }

  .toast-notification.error i {
    color: var(--danger);
  }

  .toast-content {
    flex: 1;
  }

  .toast-title {
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 0.25rem;
  }

  .toast-message {
    font-size: 0.875rem;
    color: var(--gray-600);
  }

  .toast-close {
    background: none;
    border: none;
    color: var(--gray-400);
    cursor: pointer;
    padding: 0.25rem;
    transition: color 0.2s ease;
  }

  .toast-close:hover {
    color: var(--gray-900);
  }

  /* ====== Footer ====== */
  .footer {
    position: relative;
    z-index: 10;
    text-align: center;
    color: var(--gray-600);
    font-size: 0.875rem;
    max-width: 480px;
    margin-top: 1rem;
  }

  .footer a {
    color: var(--gray-700);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .footer a:hover {
    color: var(--primary);
  }

  /* ====== Modal ====== */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 23, 42, 0.9);
    backdrop-filter: blur(8px);
    z-index: 3000;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
  }

  .modal-content {
    background: white;
    border-radius: var(--radius-xl);
    width: 100%;
    max-width: 500px;
    padding: 2.5rem;
    position: relative;
    animation: modalSlideIn 0.3s ease;
    border: 1px solid var(--gray-200);
    box-shadow: var(--shadow-xl);
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: var(--border);
  }

  .modal-header h3 {
    font-size: 1.5rem;
    color: var(--gray-900);
    margin-bottom: 0.5rem;
  }

  .modal-header p {
    color: var(--gray-600);
    font-size: 0.95rem;
  }

  .type-options {
    display: grid;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .type-option {
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .type-option:hover {
    border-color: var(--primary);
    background: rgba(0, 102, 204, 0.02);
    transform: translateY(-2px);
  }

  .type-option.selected {
    border-color: var(--primary);
    background: rgba(0, 102, 204, 0.05);
  }

  .type-icon {
    width: 48px;
    height: 48px;
    background: var(--gray-100);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-size: 1.25rem;
    flex-shrink: 0;
    border: 1px solid var(--gray-200);
  }

  .type-option.selected .type-icon {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .type-text h4 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 0.25rem;
  }

  .type-text p {
    font-size: 0.875rem;
    color: var(--gray-600);
    line-height: 1.5;
  }

  .modal-actions {
    display: flex;
    gap: 1rem;
  }

  .modal-btn {
    flex: 1;
    padding: 0.875rem;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    font-family: 'Inter', sans-serif;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .modal-btn-secondary {
    background: white;
    border: 2px solid var(--gray-300);
    color: var(--gray-700);
  }

  .modal-btn-secondary:hover {
    border-color: var(--gray-400);
    background: var(--gray-50);
  }

  .modal-btn-primary {
    background: var(--primary);
    color: white;
    border: 2px solid var(--primary);
  }

  .modal-btn-primary:hover:not(:disabled) {
    background: var(--primary-dark);
    border-color: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .modal-btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* ====== Responsive Design ====== */
  @media (max-width: 768px) {
    .header {
      display: none;
    }

    .login-container {
      margin-top: 20px;
    }

    .login-card {
      padding: 2rem;
    }

    .form-header h2 {
      font-size: 1.5rem;
    }

    .trust-badges {
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .toast-notification {
      top: 20px;
      right: 20px;
      left: 20px;
      width: auto;
    }

    .modal-content {
      padding: 2rem;
    }

    .modal-actions {
      flex-direction: column;
    }

    .type-option {
      padding: 1.25rem;
    }
  }

  @media (max-width: 480px) {
    body {
      padding: 1rem;
    }

    .login-card {
      padding: 1.5rem;
    }

    .form-options {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .card-logo-icon {
      width: 56px;
      height: 56px;
      font-size: 1.5rem;
    }

    .type-option {
      flex-direction: column;
      text-align: center;
      padding: 1.25rem;
    }

    .type-icon {
      width: 40px;
      height: 40px;
      font-size: 1rem;
    }
  }

  /* ====== Animation States ====== */
  .login-card.loading {
    opacity: 0.7;
    pointer-events: none;
  }

  .login-card.shake {
    animation: shake 0.5s ease-in-out;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
  }

  .login-card.success {
    animation: successPulse 0.6s ease;
  }

  @keyframes successPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
  }

  /* ====== Accessibility ====== */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  input:focus-visible,
  button:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }
</style>

<!-- Account Type Selection Modal -->
<div id="accountTypeModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Choose Account Type</h3>
      <p>Select the type of account you want to create</p>
    </div>
    
    <div class="type-options">
      <div class="type-option" data-type="employer">
        <div class="type-icon">
          <i class="fas fa-briefcase"></i>
        </div>
        <div class="type-text">
          <h4>Employer Account</h4>
          <p>Post job opportunities, manage candidates, and build your workforce</p>
        </div>
      </div>
      
      <div class="type-option" data-type="jobseeker">
        <div class="type-icon">
          <i class="fas fa-search"></i>
        </div>
        <div class="type-text">
          <h4>Job Seeker Account</h4>
          <p>Find opportunities, apply for positions, and manage your career profile</p>
        </div>
      </div>
    </div>
    
    <div class="modal-actions">
      <button id="cancelTypeSelection" class="modal-btn modal-btn-secondary">Cancel</button>
      <button id="continueToSignup" class="modal-btn modal-btn-primary" disabled>Continue</button>
    </div>
  </div>
</div>

<!-- Header (Hidden on mobile) -->
<header class="header">
  <div class="header-container">
    <a href="index.html" class="logo">
      <div class="logo-icon">A</div>
      <div class="logo-text">ANGAZA</div>
    </a>
    
    <nav class="nav">
      <a href="index.html" class="nav-link">Home</a>
      <a href="works.html" class="nav-link">Find Work</a>
      <a href="workers.html" class="nav-link">Find Workers</a>
      <a href="shining_zone.html" class="nav-link">Shining Zone</a>
    </nav>
  </div>
</header>

<!-- Background Pattern -->
<div class="bg-pattern">
  <div class="bg-circle bg-circle-1"></div>
  <div class="bg-circle bg-circle-2"></div>
  <div class="bg-circle bg-circle-3"></div>
</div>

<!-- Main Login Container -->
<div class="login-container">
  <div class="login-card" id="loginCard">
    <!-- Logo -->
    <div class="card-logo">
      <div class="card-logo-icon">
        <i class="fas fa-bolt"></i>
      </div>
    </div>

    <!-- Form Header -->
    <div class="form-header">
      <h2>Welcome Back</h2>
      <p>Sign in to continue to ANGAZA</p>
    </div>

    <!-- Login Form -->
    <form id="loginForm" onsubmit="event.preventDefault(); logIn();">
      <!-- Email Input -->
      <div class="form-group">
        <label for="loginEmail" class="form-label">Email Address</label>
        <div class="input-wrapper">
          <i class="fas fa-envelope"></i>
          <input 
            type="email" 
            id="loginEmail" 
            placeholder="you@example.com" 
            autocomplete="email"
            required
          >
        </div>
      </div>

      <!-- Password Input -->
      <div class="form-group">
        <label for="loginPass" class="form-label">Password</label>
        <div class="input-wrapper">
          <i class="fas fa-lock"></i>
          <input 
            type="password" 
            id="loginPass" 
            placeholder="Enter your password" 
            autocomplete="current-password"
            required
          >
          <button 
            type="button" 
            class="password-toggle" 
            onclick="togglePassword()"
            aria-label="Show password"
          >
            <i class="fas fa-eye"></i>
          </button>
        </div>
      </div>

      <!-- Form Options -->
      <div class="form-options">
        <div class="remember-me">
          <input type="checkbox" id="rememberMe" checked>
          <label for="rememberMe">Remember me</label>
        </div>
        <a href="forgot-password.html" class="forgot-link">
          Forgot password?
        </a>
      </div>

      <!-- Login Button -->
      <button type="submit" class="login-btn" id="loginBtn">
        <span>Sign In</span>
      </button>
    </form>

    <!-- Sign Up Link -->
    <div class="signup-section">
      <p>
        New to ANGAZA? 
        <a href="#" id="signupLink" class="signup-link">Create an account</a>
      </p>
    </div>

    <!-- Trust Badges -->
    <div class="trust-badges">
      <div class="trust-badge">
        <i class="fas fa-shield-alt"></i>
        <span>Secure login</span>
      </div>
      <div class="trust-badge">
        <i class="fas fa-lock"></i>
        <span>Encrypted</span>
      </div>
      <div class="trust-badge">
        <i class="fas fa-clock"></i>
        <span>24/7 support</span>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>
      <a href="platform_owner.html">Â© 2026 ANGAZA | Powered by Othman Almas Mwiha ðŸš€</a>
    </p>
  </div>
</div>

<!-- Toast Notification Container -->
<div id="toastNotification" class="toast-notification"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBm4uimZ4UNhT_c-t0Dt0WLUwgmHHIMzzk",
    authDomain: "angazasystem.firebaseapp.com",
    projectId: "angazasystem",
    storageBucket: "angazasystem.firebasestorage.app",
    messagingSenderId: "191988119746",
    appId: "1:191988119746:web:aa050634bc5d57b1bde35b",
    measurementId: "G-2RN3CLME03"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  window.logIn = async function() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPass").value;
    const loginBtn = document.getElementById("loginBtn");
    const loginCard = document.getElementById("loginCard");
    
    // Validate inputs
    if (!validateInputs()) {
      return;
    }
    
    // Show loading state
    const originalText = loginBtn.innerHTML;
    loginBtn.innerHTML = '<span class="spinner"></span> Signing in...';
    loginBtn.disabled = true;
    loginCard.classList.add('loading');

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      
      // Success animation
      loginCard.classList.remove('loading');
      loginCard.classList.add('success');
      showToast('Login successful! Redirecting...', 'success');
      
      // Redirect after delay
      setTimeout(async () => {
        try {
          const user = userCredential.user;
          const userRef = doc(db, "users", user.uid);
          const userSnap = await getDoc(userRef);

          if (!userSnap.exists()) {
            throw new Error("USER_DOC_MISSING");
          }

          const role = userSnap.data().role;

          if (role === "jobseeker") {
            window.location.href = "jobseeker-dashboard.html";
          } else if (role === "employer") {
            window.location.href = "companyd.html";
          } else {
            throw new Error("INVALID_ROLE");
          }
        } catch (err) {
          console.error(err);
          showToast(
            err.message === "USER_DOC_MISSING"
              ? "Profile not found. Please complete signup."
              : "Account role error. Contact support.",
            "error"
          );
          
          // Reset button state
          loginBtn.innerHTML = originalText;
          loginBtn.disabled = false;
          loginCard.classList.remove("loading", "success");
        }
      }, 1200);
      
    } catch (error) {
      // Reset button state
      loginBtn.innerHTML = originalText;
      loginBtn.disabled = false;
      loginCard.classList.remove('loading');
      
      // Shake animation on error
      loginCard.classList.add('shake');
      setTimeout(() => {
        loginCard.classList.remove('shake');
      }, 500);
      
      // Show error message
      let errorMessage = "";
      switch(error.code) {
        case 'auth/user-not-found':
          errorMessage = "No account found with this email. Please sign up.";
          break;
        case 'auth/wrong-password':
          errorMessage = "Incorrect password. Please try again.";
          break;
        case 'auth/invalid-email':
          errorMessage = "Please enter a valid email address.";
          break;
        case 'auth/too-many-requests':
          errorMessage = "Too many login attempts. Please try again later.";
          break;
        default:
          errorMessage = "Login failed. Please check your credentials.";
      }
      
      showToast(errorMessage, 'error');
    }
  }

  // Input validation
  function validateInputs() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPass").value;
    
    if (!email) {
      showToast("Please enter your email address", 'error');
      document.getElementById("loginEmail").focus();
      return false;
    }
    
    if (!password) {
      showToast("Please enter your password", 'error');
      document.getElementById("loginPass").focus();
      return false;
    }
    
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      showToast("Please enter a valid email address", 'error');
      document.getElementById("loginEmail").focus();
      return false;
    }
    
    return true;
  }

  // Toast notification
  window.showToast = function(message, type = 'info') {
    const toast = document.getElementById('toastNotification');
    
    let title = '';
    let icon = '';
    
    switch(type) {
      case 'success':
        title = 'Success';
        icon = 'check-circle';
        break;
      case 'error':
        title = 'Error';
        icon = 'exclamation-circle';
        break;
      default:
        title = 'Info';
        icon = 'info-circle';
    }
    
    toast.className = `toast-notification ${type}`;
    toast.innerHTML = `
      <i class="fas fa-${icon}"></i>
      <div class="toast-content">
        <div class="toast-title">${title}</div>
        <div class="toast-message">${message}</div>
      </div>
      <button class="toast-close" onclick="this.closest('.toast-notification').classList.remove('show')">
        <i class="fas fa-times"></i>
      </button>
    `;
    
    setTimeout(() => {
      toast.classList.add('show');
    }, 10);
    
    setTimeout(() => {
      toast.classList.remove('show');
    }, 5000);
  }

  // Auth state observer
  onAuthStateChanged(auth, (user) => {
    console.log(user ? "User session active" : "No user session");
    localStorage.setItem("redirectAfterLogin", window.location.href);
  });

  // Make functions globally available
  window.togglePassword = function() {
    const passwordInput = document.getElementById('loginPass');
    const toggleButton = document.querySelector('.password-toggle i');
    
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      toggleButton.className = 'fas fa-eye-slash';
    } else {
      passwordInput.type = 'password';
      toggleButton.className = 'fas fa-eye';
    }
  }
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Modal elements
    const accountTypeModal = document.getElementById('accountTypeModal');
    const signupLink = document.getElementById('signupLink');
    const cancelTypeSelection = document.getElementById('cancelTypeSelection');
    const continueToSignup = document.getElementById('continueToSignup');
    const typeOptions = document.querySelectorAll('.type-option');
    
    // State
    let selectedAccountType = null;
    
    // Show modal
    function showAccountTypeModal() {
      accountTypeModal.style.display = 'flex';
      selectedAccountType = null;
      continueToSignup.disabled = true;
      typeOptions.forEach(option => option.classList.remove('selected'));
    }
    
    // Hide modal
    function hideAccountTypeModal() {
      accountTypeModal.style.display = 'none';
    }
    
    // Handle account type selection
    function handleAccountTypeSelect(type) {
      selectedAccountType = type;
      continueToSignup.disabled = false;
      
      typeOptions.forEach(option => {
        if (option.dataset.type === type) {
          option.classList.add('selected');
        } else {
          option.classList.remove('selected');
        }
      });
    }
    
    // Redirect based on account type
    function redirectBasedOnAccountType() {
      if (!selectedAccountType) return;
      
      if (selectedAccountType === 'jobseeker') {
        window.location.href = 'signup.html';
      } else if (selectedAccountType === 'employer') {
        window.location.href = 'esignup.html';
      }
    }
    
    // Event listeners
    typeOptions.forEach(option => {
      option.addEventListener('click', () => {
        handleAccountTypeSelect(option.dataset.type);
      });
    });
    
    cancelTypeSelection.addEventListener('click', hideAccountTypeModal);
    continueToSignup.addEventListener('click', redirectBasedOnAccountType);
    
    // Signup link
    signupLink.addEventListener('click', (e) => {
      e.preventDefault();
      showAccountTypeModal();
    });
    
    // Close modal with ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && accountTypeModal.style.display === 'flex') {
        hideAccountTypeModal();
      }
    });
    
    // Close modal on outside click
    accountTypeModal.addEventListener('click', (e) => {
      if (e.target === accountTypeModal) {
        hideAccountTypeModal();
      }
    });
    
    // Auto-focus email input
    const emailInput = document.getElementById('loginEmail');
    setTimeout(() => {
      if (emailInput) emailInput.focus();
    }, 300);
    
    // Enter key handler is now handled by form onsubmit
    
    // Add animation on input focus
    const inputs = document.querySelectorAll('.input-wrapper input');
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        this.parentElement.querySelector('i').style.color = 'var(--primary)';
      });
      
      input.addEventListener('blur', function() {
        if (!this.value) {
          this.parentElement.querySelector('i').style.color = 'var(--gray-400)';
        }
      });
    });
  });
</script>
</body>
</html>
