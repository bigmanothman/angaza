<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sign Up | ANGAZA Employment Connection Platform</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ========== General Styles ========== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #f8f9fa;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-attachment: fixed;
  position: relative;
  overflow-x: hidden;
  padding: 20px;
}

/* Animated background */
.bg-shapes {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  overflow: hidden;
}

.shape {
  position: absolute;
  background: rgba(255, 211, 42, 0.05);
  border-radius: 50%;
  animation: floatShape 20s infinite linear;
}

@keyframes floatShape {
  0% {
    transform: translateY(0) translateX(0) rotate(0deg);
    opacity: 0;
  }
  10% {
    opacity: 0.3;
  }
  90% {
    opacity: 0.3;
  }
  100% {
    transform: translateY(-100vh) translateX(100px) rotate(180deg);
    opacity: 0;
  }
}

/* ========== Main Container ========== */
.container {
  position: relative;
  width: 100%;
  max-width: 480px;
  margin: 20px;
  padding: 40px 35px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 24px;
  backdrop-filter: blur(15px);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.1);
  text-align: center;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  z-index: 1;
}

.container:hover {
  transform: translateY(-5px);
  box-shadow: 
    0 12px 40px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

/* Loading state */
.container.loading::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, #ffd32a, #ffc312);
  border-radius: 24px 24px 0 0;
  z-index: 2;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* Success state */
.container.success {
  animation: successPulse 0.6s ease;
}

@keyframes successPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

/* Error state */
.container.shake {
  animation: shake 0.5s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}

/* ========== Logo ========== */
.logo {
  font-size: 2.2rem;
  font-weight: 700;
  color: #ffd32a;
  text-shadow: 0 0 15px rgba(255, 211, 42, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 25px;
}

.logo i {
  font-size: 1.8rem;
}

/* ========== Form Header ========== */
.form-header {
  margin-bottom: 30px;
}

.form-header h2 {
  font-size: 1.8rem;
  font-weight: 600;
  color: #fff;
  margin-bottom: 10px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.form-header p {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.95rem;
  line-height: 1.5;
}

/* ========== Input Wrapper ========== */
.input-wrapper {
  position: relative;
  width: 100%;
  margin: 0 0 20px 0;
  transition: all 0.3s ease;
}

.input-wrapper:focus-within {
  transform: translateY(-2px);
}

.input-wrapper input,
.input-wrapper select {
  width: 100%;
  padding: 16px 20px 16px 50px;
  border-radius: 12px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  outline: none;
  background: rgba(255, 255, 255, 0.05);
  color: #fff;
  font-size: 1rem;
  font-family: "Poppins", sans-serif;
  transition: all 0.3s ease;
  box-sizing: border-box;
}

.input-wrapper input:focus,
.input-wrapper select:focus {
  border-color: #ffd32a;
  background: rgba(255, 211, 42, 0.05);
  box-shadow: 0 0 0 3px rgba(255, 211, 42, 0.1);
}

.input-wrapper input::placeholder,
.input-wrapper select::placeholder {
  color: rgba(255, 255, 255, 0.4);
  font-weight: 400;
}

/* Input icons */
.input-wrapper i:not(.eye-icon) {
  position: absolute;
  left: 18px;
  top: 50%;
  transform: translateY(-50%);
  color: #ffd32a;
  font-size: 1.1rem;
  transition: all 0.3s ease;
  pointer-events: none;
}

.input-wrapper:focus-within i:not(.eye-icon) {
  color: #ffc312;
  transform: translateY(-50%) scale(1.1);
}

/* Password toggle */
.eye-icon {
  position: absolute;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  cursor: pointer;
  font-size: 1.1rem;
  padding: 5px;
  transition: color 0.3s ease;
  z-index: 2;
}

.eye-icon:hover {
  color: #ffd32a;
}

/* File input customization */
.input-wrapper input[type="file"] {
  padding: 14px 20px 14px 50px;
  cursor: pointer;
}

.input-wrapper input[type="file"]::-webkit-file-upload-button {
  display: none;
}

.input-wrapper input[type="file"]::file-selector-button {
  display: none;
}

/* Select dropdown styling */
.input-wrapper select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23ffd32a' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 18px center;
  padding-right: 50px !important;
}

.input-wrapper select option {
  background: #1c2e35;
  color: #fff;
  padding: 12px;
  font-size: 0.95rem;
}

/* ========== File Note ========== */
.file-note {
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.6);
  margin-top: -15px;
  margin-bottom: 15px;
  text-align: left;
  padding-left: 10px;
}

/* ========== Terms Checkbox ========== */
.terms {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin: 20px 0;
  padding: 15px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  text-align: left;
}

.terms input {
  margin-top: 4px;
  accent-color: #ffd32a;
  transform: scale(1.2);
  cursor: pointer;
}

.terms label {
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.95rem;
  line-height: 1.5;
  cursor: pointer;
  flex: 1;
}

.terms a {
  color: #ffd32a;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.3s ease;
}

.terms a:hover {
  color: #ffc312;
  text-decoration: underline;
}

/* ========== Error Message ========== */
.error-msg {
  color: #ff6b6b;
  font-size: 0.9rem;
  margin: 15px 0;
  padding: 12px;
  background: rgba(255, 107, 107, 0.1);
  border: 1px solid rgba(255, 107, 107, 0.2);
  border-radius: 8px;
  display: none;
  text-align: left;
  line-height: 1.4;
}

.error-msg i {
  margin-right: 8px;
}

/* ========== Success Message ========== */
.success-note {
  color: #51cf66;
  font-size: 0.95rem;
  margin: 15px 0;
  padding: 12px;
  background: rgba(81, 207, 102, 0.1);
  border: 1px solid rgba(81, 207, 102, 0.2);
  border-radius: 8px;
  display: none;
  text-align: center;
  line-height: 1.4;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.success-note i {
  margin-right: 8px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ========== Button ========== */
.btn-group {
  width: 100%;
  margin-top: 10px;
}

.signup-btn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, #ffd32a, #ffc312);
  color: #0a3d62;
  border: none;
  border-radius: 12px;
  font-family: "Poppins", sans-serif;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(255, 211, 42, 0.3);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.signup-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255, 255, 255, 0.5);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%);
  transform-origin: 50% 50%;
}

.signup-btn:focus:not(:active)::after {
  animation: ripple 1s ease-out;
}

@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 0.5;
  }
  100% {
    transform: scale(20, 20);
    opacity: 0;
  }
}

.signup-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 211, 42, 0.5);
}

.signup-btn:active:not(:disabled) {
  transform: translateY(0);
}

.signup-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
}

/* ========== Cancel Button ========== */
.cancel-btn {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 36px;
  height: 36px;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 50%;
  color: #fff;
  font-size: 1.3rem;
  font-weight: 300;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  z-index: 10;
}

.cancel-btn:hover {
  background: rgba(255, 0, 0, 0.2);
  transform: rotate(90deg) scale(1.1);
}

/* ========== Footer ========== */
footer {
  text-align: center;
  padding: 20px;
  color: rgba(255, 255, 255, 0.6);
  margin-top: 30px;
  font-size: 0.85rem;
  max-width: 480px;
}

footer a {
  color: #ffd32a;
  text-decoration: none;
  transition: color 0.3s ease;
}

footer a:hover {
  color: #ffc312;
}

/* ========== Toast Notification ========== */
.toast-notification {
  position: fixed;
  top: 30px;
  right: 30px;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 12px;
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  transform: translateX(150%);
  transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  z-index: 1000;
  max-width: 350px;
}

.toast-notification.show {
  transform: translateX(0);
}

.toast-notification.success {
  border-left: 4px solid #22c55e;
}

.toast-notification.error {
  border-left: 4px solid #ef4444;
}

.toast-notification i {
  font-size: 1.2rem;
}

.toast-notification.success i {
  color: #22c55e;
}

.toast-notification.error i {
  color: #ef4444;
}

.toast-notification span {
  color: #0f172a;
  font-weight: 500;
  flex: 1;
  font-size: 0.95rem;
}

.toast-close {
  background: none;
  border: none;
  color: rgba(0, 0, 0, 0.5);
  cursor: pointer;
  font-size: 0.9rem;
  padding: 5px;
  transition: color 0.3s ease;
}

.toast-close:hover {
  color: #000;
}

/* ========== Responsive Design ========== */
@media (max-width: 768px) {
  .container {
    margin: 15px;
    padding: 35px 25px;
    max-width: 440px;
  }
  
  .logo {
    font-size: 1.9rem;
  }
  
  .form-header h2 {
    font-size: 1.6rem;
  }
  
  .input-wrapper input,
  .input-wrapper select {
    padding: 14px 20px 14px 45px;
  }
  
  .toast-notification {
    top: 20px;
    right: 20px;
    left: 20px;
    max-width: calc(100% - 40px);
  }
}

@media (max-width: 480px) {
  body {
    padding: 15px;
    justify-content: flex-start;
    padding-top: 40px;
  }
  
  .container {
    margin: 0;
    padding: 30px 20px;
    max-width: 100%;
  }
  
  .logo {
    font-size: 1.7rem;
    margin-bottom: 20px;
  }
  
  .form-header h2 {
    font-size: 1.4rem;
  }
  
  .form-header p {
    font-size: 0.9rem;
  }
  
  .input-wrapper input,
  .input-wrapper select {
    padding: 13px 20px 13px 42px;
    font-size: 0.95rem;
  }
  
  .input-wrapper i:not(.eye-icon) {
    left: 15px;
    font-size: 1rem;
  }
  
  .eye-icon {
    right: 15px;
    font-size: 1rem;
  }
  
  .signup-btn {
    padding: 15px;
    font-size: 0.95rem;
  }
  
  .terms {
    padding: 12px;
  }
  
  .cancel-btn {
    top: 15px;
    right: 15px;
    width: 32px;
    height: 32px;
    font-size: 1.2rem;
  }
  
  footer {
    padding: 15px;
    font-size: 0.8rem;
  }
}

@media (max-height: 800px) {
  body {
    padding-top: 20px;
  }
  
  .container {
    margin-top: 20px;
    padding: 25px 20px;
  }
  
  .input-wrapper {
    margin-bottom: 16px;
  }
  
  .terms {
    margin: 15px 0;
  }
}

/* ========== Accessibility ========== */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

input:focus-visible,
button:focus-visible,
select:focus-visible,
.cancel-btn:focus-visible {
  outline: 2px solid #ffd32a;
  outline-offset: 2px;
}

/* ========== Password Strength Indicator ========== */
.password-strength {
  margin-top: 5px;
  margin-bottom: 10px;
  display: none;
}

.strength-bar {
  height: 4px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 2px;
  overflow: hidden;
  margin-bottom: 5px;
}

.strength-fill {
  height: 100%;
  width: 0%;
  background: #ef4444;
  border-radius: 2px;
  transition: width 0.3s ease, background-color 0.3s ease;
}

.strength-fill.weak { width: 25%; background: #ef4444; }
.strength-fill.fair { width: 50%; background: #f59e0b; }
.strength-fill.good { width: 75%; background: #3b82f6; }
.strength-fill.strong { width: 100%; background: #22c55e; }

.strength-text {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
  text-align: left;
}

/* ========== Loading Spinner ========== */
.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #ffd32a;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>
<body>
  <!-- Animated Background Shapes -->
  <div class="bg-shapes" id="shapesContainer"></div>

  <!-- Main Signup Container -->
  <div class="container" aria-live="polite">
    <!-- Cancel Button -->
    <button class="cancel-btn" onclick="handleCancel()" aria-label="Close signup form">
      Ã—
    </button>

    <!-- Logo -->
    <div class="logo">
      <i class="fas fa-bolt"></i>
      ANGAZA
    </div>

    <!-- Form Header -->
    <div class="form-header">
      <h2>Join ANGAZA</h2>
      <p>Create your account and start connecting with opportunities</p>
    </div>

    <!-- Full Name -->
    <div class="input-wrapper">
      <i class="fas fa-user"></i>
      <input 
        id="fullName" 
        type="text" 
        placeholder="Full Name" 
        autocomplete="name"
        aria-label="Full Name"
        required
      >
    </div>

    <!-- Username -->
    <div class="input-wrapper">
      <i class="fas fa-id-badge"></i>
      <input 
        id="username" 
        type="text" 
        placeholder="Username (unique)" 
        autocomplete="username"
        aria-label="Username"
        required
      >
    </div>

    <!-- Phone -->
    <div class="input-wrapper">
      <i class="fas fa-phone"></i>
      <input 
        id="phone" 
        type="tel" 
        placeholder="+255 700 000 000" 
        inputmode="tel"
        autocomplete="tel"
        aria-label="Phone Number"
      >
    </div>

    <!-- Location -->
    <div class="input-wrapper">
      <i class="fas fa-map-marker-alt"></i>
      <input 
        id="location" 
        type="text" 
        placeholder="Location (e.g., Dar es Salaam)" 
        autocomplete="address-level2"
        aria-label="Location"
      >
    </div>

    <!-- Email -->
    <div class="input-wrapper">
      <i class="fas fa-envelope"></i>
      <input 
        id="email" 
        type="email" 
        placeholder="Email address" 
        autocomplete="email"
        aria-label="Email Address"
        required
      >
    </div>

    <!-- Password -->
    <div class="input-wrapper">
      <i class="fas fa-lock"></i>
      <input 
        id="password" 
        type="password" 
        placeholder="Password (min 8 characters)" 
        autocomplete="new-password"
        aria-label="Password"
        required
      >
      <i 
        id="togglePwd" 
        class="fas fa-eye eye-icon" 
        title="Show/Hide password"
        aria-label="Toggle password visibility"
      ></i>
    </div>

    <!-- Password Strength Indicator -->
    <div class="password-strength" id="passwordStrength">
      <div class="strength-bar">
        <div class="strength-fill" id="strengthFill"></div>
      </div>
      <div class="strength-text" id="strengthText"></div>
    </div>

    <!-- Confirm Password -->
    <div class="input-wrapper">
      <i class="fas fa-lock"></i>
      <input 
        id="confirmPassword" 
        type="password" 
        placeholder="Confirm Password" 
        autocomplete="new-password"
        aria-label="Confirm Password"
        required
      >
      <i 
        id="toggleConfirmPwd" 
        class="fas fa-eye eye-icon" 
        title="Show/Hide password"
        aria-label="Toggle password visibility"
      ></i>
    </div>

    <input type="hidden" id="role" value="jobseeker">

    <!-- Profile Picture -->
    <div class="input-wrapper">
      <i class="fas fa-image"></i>
      <input 
        id="profilePic" 
        type="file" 
        accept="image/*"
        aria-label="Profile Picture"
      >
    </div>
    <div class="file-note">Optional: Profile image (JPG/PNG) - Max 5MB</div>

    <!-- Terms & Conditions -->
    <div class="terms">
      <input 
        id="terms" 
        type="checkbox"
        aria-label="Accept Terms and Conditions"
        required
      >
      <label for="terms">
        I agree to the <a href="terms.html">Terms & Conditions</a> and <a href="privacy.html">Privacy Policy</a>
      </label>
    </div>

    <!-- Error Message -->
    <div id="errorMsg" class="error-msg" role="alert" aria-live="assertive">
      <i class="fas fa-exclamation-circle"></i>
      <span id="errorText"></span>
    </div>

    <!-- Success Message -->
    <div id="successNote" class="success-note" role="alert" aria-live="polite">
      <i class="fas fa-check-circle"></i>
      <span>Signup successful â€” verification email sent. Redirectingâ€¦</span>
    </div>

    <!-- Signup Button -->
    <div class="btn-group">
      <button 
        id="signupBtn" 
        class="signup-btn" 
        type="button"
        aria-label="Create Account"
      >
        Create Account
      </button>
    </div>

    <!-- Login Link -->
    <div style="margin-top: 20px; font-size: 0.95rem; color: rgba(255, 255, 255, 0.7);">
      Already have an account? <a href="login.html" style="color: #ffd32a; font-weight: 500;">Sign in here</a>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>
      <a href="platform_owner.html" aria-label="Platform owner information">
        Â© 2026 ANGAZA | Powered by Othman Almas Mwiha ðŸš€
      </a>
    </p>
    <p style="margin-top: 8px; font-size: 0.8rem; opacity: 0.7;">
      Transforming employment connections across Africa
    </p>
  </footer>

<!-- Firebase + App logic -->
<script type="module">
/* ================== Firebase imports ================== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  sendEmailVerification,
  updateProfile
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

import {
  getFirestore,
  doc,
  setDoc,
  collection,
  query,
  where,
  getDocs,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

import {
  getStorage,
  ref as storageRef,
  uploadBytes,
  getDownloadURL
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

/* ================== Firebase config ================== */
const firebaseConfig = {
  apiKey: "AIzaSyBm4uimZ4UNhT_c-t0Dt0WLUwgmHHIMzzk",
  authDomain: "angazasystem.firebaseapp.com",
  projectId: "angazasystem",
  storageBucket: "angazasystem.appspot.com",
  messagingSenderId: "191988119746",
  appId: "1:191988119746:web:aa050634bc5d57b1bde35b",
  measurementId: "G-2RN3CLME03"
};

/* ============ Initialize Firebase services ============ */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

/* ================== Helper DOM refs ================== */
const el = id => document.getElementById(id);
const errorMsg = el('errorMsg');
const errorText = el('errorText');
const successNote = el('successNote');
const signupBtn = el('signupBtn');
const passwordStrength = el('passwordStrength');
const strengthFill = el('strengthFill');
const strengthText = el('strengthText');

/* ================== Utility functions ================== */
function showError(msg) {
  errorMsg.style.display = 'block';
  errorText.textContent = msg;
  successNote.style.display = 'none';
}

function clearError() {
  errorMsg.style.display = 'none';
  errorText.textContent = '';
}

function showSuccess(msg) {
  successNote.style.display = 'block';
  successNote.querySelector('span').textContent = msg;
  errorMsg.style.display = 'none';
}

// Toast notification function
function showToast(message, type = 'info') {
  // Remove existing toast
  const existingToast = document.getElementById('toastNotification');
  if (existingToast) {
    existingToast.remove();
  }
  
  // Create new toast
  const toast = document.createElement('div');
  toast.id = 'toastNotification';
  toast.className = `toast-notification ${type}`;
  toast.innerHTML = `
    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
    <span>${message}</span>
    <button class="toast-close" onclick="this.parentElement.remove()">
      <i class="fas fa-times"></i>
    </button>
  `;
  
  document.body.appendChild(toast);
  
  // Show toast
  setTimeout(() => {
    toast.classList.add('show');
  }, 10);
  
  // Auto remove after 5 seconds
  setTimeout(() => {
    if (toast.parentNode) {
      toast.classList.remove('show');
      setTimeout(() => {
        if (toast.parentNode) toast.remove();
      }, 300);
    }
  }, 5000);
}

/* ================== Password strength checker ================== */
function checkPasswordStrength(password) {
  let score = 0;
  
  // Length check
  if (password.length >= 8) score += 1;
  if (password.length >= 12) score += 1;
  
  // Character variety checks
  if (/[a-z]/.test(password)) score += 1; // Lowercase
  if (/[A-Z]/.test(password)) score += 1; // Uppercase
  if (/[0-9]/.test(password)) score += 1; // Numbers
  if (/[^A-Za-z0-9]/.test(password)) score += 1; // Special chars
  
  // Determine strength level
  if (score <= 2) return { level: 'weak', percent: 25 };
  if (score <= 4) return { level: 'fair', percent: 50 };
  if (score <= 6) return { level: 'good', percent: 75 };
  return { level: 'strong', percent: 100 };
}

function updatePasswordStrength(password) {
  if (!password) {
    passwordStrength.style.display = 'none';
    return;
  }
  
  passwordStrength.style.display = 'block';
  const strength = checkPasswordStrength(password);
  
  strengthFill.className = 'strength-fill ' + strength.level;
  strengthFill.style.width = strength.percent + '%';
  
  const messages = {
    weak: 'Weak - Add more characters and variety',
    fair: 'Fair - Add uppercase letters and numbers',
    good: 'Good - Add a special character for strength',
    strong: 'Strong password!'
  };
  
  strengthText.textContent = messages[strength.level];
}

/* ================== Input validation ================== */
function validateForm() {
  const fullName = el('fullName').value.trim();
  const username = el('username').value.trim();
  const email = el('email').value.trim();
  const password = el('password').value;
  const confirmPassword = el('confirmPassword').value;
  const role = "jobseeker";
  const termsAccepted = el('terms').checked;
  
  // Check required fields
  if (!fullName || !username || !email || !password || !confirmPassword || !role) {
    showError('Please fill all required fields');
    return false;
  }
  
  // Email validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    showError('Please enter a valid email address');
    el('email').focus();
    return false;
  }
  
  // Username validation (alphanumeric and underscores)
  const usernameRegex = /^[a-zA-Z0-9_]+$/;
  if (!usernameRegex.test(username)) {
    showError('Username can only contain letters, numbers, and underscores');
    el('username').focus();
    return false;
  }
  
  if (username.length < 3) {
    showError('Username must be at least 3 characters long');
    el('username').focus();
    return false;
  }
  
  // Password validation
  if (password.length < 8) {
    showError('Password must be at least 8 characters long');
    el('password').focus();
    return false;
  }
  
  // Check password match
  if (password !== confirmPassword) {
    showError('Passwords do not match');
    el('confirmPassword').focus();
    return false;
  }
  
  // Terms acceptance
  if (!termsAccepted) {
    showError('You must accept Terms & Conditions');
    return false;
  }
  
  return true;
}

/* ================== Password toggle handlers ================== */
el('togglePwd').addEventListener('click', () => {
  const inp = el('password');
  const ic = el('togglePwd');
  if (inp.type === 'password') {
    inp.type = 'text';
    ic.classList.replace('fa-eye', 'fa-eye-slash');
    ic.setAttribute('title', 'Hide password');
  } else {
    inp.type = 'password';
    ic.classList.replace('fa-eye-slash', 'fa-eye');
    ic.setAttribute('title', 'Show password');
  }
});

el('toggleConfirmPwd').addEventListener('click', () => {
  const inp = el('confirmPassword');
  const ic = el('toggleConfirmPwd');
  if (inp.type === 'password') {
    inp.type = 'text';
    ic.classList.replace('fa-eye', 'fa-eye-slash');
    ic.setAttribute('title', 'Hide password');
  } else {
    inp.type = 'password';
    ic.classList.replace('fa-eye-slash', 'fa-eye');
    ic.setAttribute('title', 'Show password');
  }
});

/* ================== Real-time password strength ================== */
el('password').addEventListener('input', function() {
  updatePasswordStrength(this.value);
});

/* ================== Username uniqueness check ================== */
async function isUsernameTaken(username) {
  if (!username || username.length < 3) return false;
  const usersRef = collection(db, 'users');
  const q = query(usersRef, where('username', '==', username));
  const snap = await getDocs(q);
  return !snap.empty;
}

// Real-time username availability check
let usernameCheckTimeout;
el('username').addEventListener('input', function() {
  const username = this.value.trim();
  clearTimeout(usernameCheckTimeout);
  
  if (username.length >= 3) {
    usernameCheckTimeout = setTimeout(async () => {
      const taken = await isUsernameTaken(username);
      if (taken) {
        showError('Username is already taken');
      } else {
        clearError();
      }
    }, 500);
  }
});

/* ================== Upload profile picture to Storage ================== */
async function uploadProfilePic(uid, file) {
  if (!file) return null;
  
  // File type validation
  const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
  if (!validTypes.includes(file.type)) {
    throw new Error('Please upload a valid image (JPG, PNG, GIF)');
  }
  
  // File size validation (5MB)
  const maxBytes = 5 * 1024 * 1024;
  if (file.size > maxBytes) {
    throw new Error('Profile image too large (max 5MB)');
  }
  
  // Upload file
  const ext = file.name.split('.').pop();
  const path = `profile_pics/${uid}_${Date.now()}.${ext}`;
  const sRef = storageRef(storage, path);
  const snapshot = await uploadBytes(sRef, file);
  const url = await getDownloadURL(snapshot.ref);
  return url;
}

/* ================== Main signup handler ================== */
signupBtn.addEventListener('click', async () => {
  // Validate form first
  if (!validateForm()) {
    return;
  }
  
  // Get form values
  const fullName = el('fullName').value.trim();
  const username = el('username').value.trim();
  const phone = el('phone').value.trim();
  const location = el('location').value.trim();
  const email = el('email').value.trim();
  const password = el('password').value;
  const role = el('role').value;
  const profileFile = el('profilePic').files[0] || null;
  
  // Check username availability
  const taken = await isUsernameTaken(username);
  if (taken) {
    showError('Username is already taken. Please choose another.');
    el('username').focus();
    return;
  }
  
  // Disable button and show loading
  signupBtn.disabled = true;
  const originalText = signupBtn.innerHTML;
  signupBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';
  
  // Add loading animation to container
  const container = document.querySelector('.container');
  container.classList.add('loading');
  
  try {
    // Create user with email/password
    const userCred = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCred.user;
    
    // Upload profile picture (optional)
    let photoURL = null;
    if (profileFile) {
      try {
        photoURL = await uploadProfilePic(user.uid, profileFile);
        showToast('Profile picture uploaded successfully!', 'success');
      } catch (uploadError) {
        console.warn('Profile upload error:', uploadError);
        // Continue without profile picture
      }
    }
    
    // Save user profile to Firestore
    await setDoc(doc(db, 'users', user.uid), {
      uid: user.uid,
      fullName,
      username,
      phone: phone || null,
      location: location || null,
      email,
      role: "jobseeker",
      photoURL: photoURL || null,
      createdAt: serverTimestamp(),
      lastLogin: serverTimestamp(),
      emailVerified: false,
      profileComplete: 60 // Based on provided info
    });
    
    // Update Firebase auth profile
    try {
      await updateProfile(user, {
        displayName: fullName,
        photoURL: photoURL || null
      });
    } catch (profileError) {
      console.warn('Profile update error:', profileError);
    }
    
    // Send verification email
    try {
      await sendEmailVerification(user);
      showToast('Verification email sent! Please check your inbox.', 'success');
    } catch (verificationError) {
      console.warn('Verification email error:', verificationError);
    }
    
    // Show success state
    container.classList.remove('loading');
    container.classList.add('success');
    showSuccess('Account created successfully! Redirecting...');
    
    // Update button state
    signupBtn.innerHTML = '<i class="fas fa-check"></i> Account Created!';
    
    // Save user data to localStorage for immediate access
    localStorage.setItem('angaza_user', JSON.stringify({
      uid: user.uid,
      name: fullName,
      email: email,
      role: role,
      photoURL: photoURL
    }));
    
    // Redirect to dashboard after delay
    setTimeout(() => {
      window.location.href = 'jobseeker-dashboard.html';
    }, 2000);
    
  } catch (error) {
    console.error('Signup error:', error);
    
    // Remove loading state
    container.classList.remove('loading');
    container.classList.add('shake');
    setTimeout(() => container.classList.remove('shake'), 500);
    
    // Reset button
    signupBtn.disabled = false;
    signupBtn.innerHTML = originalText;
    
    // Show appropriate error message
    let errorMessage = 'Signup failed: ';
    switch(error.code) {
      case 'auth/email-already-in-use':
        errorMessage = 'This email is already registered. Please sign in instead.';
        break;
      case 'auth/invalid-email':
        errorMessage = 'Please enter a valid email address.';
        break;
      case 'auth/weak-password':
        errorMessage = 'Password is too weak. Please choose a stronger password.';
        break;
      case 'auth/network-request-failed':
        errorMessage = 'Network error. Please check your connection and try again.';
        break;
      case 'auth/too-many-requests':
        errorMessage = 'Too many attempts. Please try again later.';
        break;
      default:
        errorMessage += error.message || 'Unknown error occurred';
    }
    
    showError(errorMessage);
    
    // Show toast notification
    showToast(errorMessage, 'error');
  }
});
</script>

<script>
// Create animated background shapes
function createShapes() {
  const container = document.getElementById('shapesContainer');
  const shapeCount = Math.min(15, Math.floor(window.innerWidth / 50));
  
  for (let i = 0; i < shapeCount; i++) {
    const shape = document.createElement('div');
    shape.className = 'shape';
    
    // Random properties
    const size = Math.random() * 100 + 30;
    const left = Math.random() * 100;
    const delay = Math.random() * 20;
    const duration = Math.random() * 15 + 20;
    
    shape.style.width = `${size}px`;
    shape.style.height = `${size}px`;
    shape.style.left = `${left}vw`;
    shape.style.animationDelay = `${delay}s`;
    shape.style.animationDuration = `${duration}s`;
    
    container.appendChild(shape);
  }
}

// Cancel button handler
function handleCancel() {
  if (document.referrer && document.referrer.includes(window.location.hostname)) {
    window.history.back();
  } else {
    window.location.href = 'index.html';
  }
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  // Create background shapes
  createShapes();
  
  // Auto-focus first input
  setTimeout(() => {
    el('fullName').focus();
  }, 300);
  
  // Real-time form validation
  const inputs = document.querySelectorAll('input, select');
  inputs.forEach(input => {
    input.addEventListener('blur', function() {
      if (this.hasAttribute('required') && !this.value.trim()) {
        this.style.borderColor = 'rgba(255, 107, 107, 0.5)';
      } else {
        this.style.borderColor = '';
      }
    });
    
    input.addEventListener('input', function() {
      this.style.borderColor = '';
      clearError();
    });
  });
  
  // Enter key to submit
  document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !signupBtn.disabled) {
      const activeElement = document.activeElement;
      if (activeElement.tagName === 'INPUT' || activeElement.tagName === 'SELECT') {
        e.preventDefault();
        signupBtn.click();
      }
    }
  });
  
  // File input preview
  el('profilePic').addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
      // Validate file size
      if (file.size > 5 * 1024 * 1024) {
        showError('File is too large (max 5MB)');
        this.value = '';
      } else {
        clearError();
        showToast('Profile picture selected', 'success');
      }
    }
  });
});

// Handle window resize
let resizeTimeout;
window.addEventListener('resize', function() {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => {
    const container = document.getElementById('shapesContainer');
    container.innerHTML = '';
    createShapes();
  }, 250);
});
</script>
</body>
</html>
